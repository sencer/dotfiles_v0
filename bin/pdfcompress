#!/bin/bash

if [[ $1 == -i ]]; then
  inplace=1
  shift
fi
if [[ $1 != *.pdf ]]; then
  echo "$1 is not a pdf file."
  exit 0
fi
while [[ $# -gt 0 ]]; do
  if [[ -f $1 ]]; then
    echo -n "Compressing $1... ($(du -h $1|cut -f1) to "
    /usr/bin/gs -sDEVICE=pdfwrite -dCompatibilityLevel=1.5 -dPDFSETTINGS=/prepress \
      -dAutoFilterColorImages=false -dColorImageFilter=/FlateEncode -dNOPAUSE\
      -dQUIET -dBATCH -sOutputFile=${1%.pdf}.compressed.pdf $1
    echo "$(du -h ${1%.pdf}.compressed.pdf|cut -f1))"
    if [[ inplace -eq 1 ]]; then
      echo -n "Moving "
      mv -vf ${1%.pdf}.compressed.pdf $1
    fi
  else
    echo "File $1 not found."
  fi
  shift
done
