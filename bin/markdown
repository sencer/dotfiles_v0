#!/usr/bin/env ruby

require 'coderay'
require 'redcarpet'

class MarkdownRenderer < Redcarpet::Render::HTML
  def block_code(code, language)
    CodeRay.highlight(code, language)
  end
end

def markdown(text)
  rndr = MarkdownRenderer.new(:filter_html => true, :hard_wrap => false)
  options = {
    fenced_code_blocks: true,
     no_intra_emphasis: true,
              autolink: true,
         strikethrough: true,
       lax_html_blocks: true,
           superscript: true,
             underline: true,
             highlight: true,
             footnotes: true,
                tables: true,
                quotes: true
  }
  markdown_to_html = Redcarpet::Markdown.new(rndr, options)
  markdown_to_html.render(text)
end

puts markdown(STDIN.read)
