#!/bin/bash
{
  export USER="sselcuk"
  while read line; do
    if [[ $line == "PBS Job Id"* ]]; then
      job=( ${line//[.-]/ } )
    elif [[ $line == "Job Name"* ]]; then
      name=( ${line//./ } )
    fi
  done
  job_path=$(ssh -y -vvv -S none -i /home/sselcuk/.ssh/id_rsa ${job[4]} "~/bin/qstat -f ${job[3]}"|\
    sed -rn '/Output_Path/,+1H;g;${s/\n\s*|(.*:|'$USER'|home|scratch)\/|[^/]*$//g;p}')
  printf "%s %-8s %-8s %-20s %-30s\n" $(date +"%Y-%m-%d %H:%M") ${job[4]} ${job[3]} ${name[2]} $HOME/${job[4]}/${job_path:-"g*/${name[2]//-/\/}"}
} >> $HOME/.dotfiles/tmp/mails.log
