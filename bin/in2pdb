#!/bin/bash

awk '$1 ~ /celldm/ {
       a = $3 * 0.529177249
       getline
       b = a * $3
       getline
       c = a * $3
       printf "CRYST1   %6.3f    %6.3f    %6.3f   90.00  90.00  90.00 P1          1\n", a, b, c
     }
     $1 ~ /nat/ {
       j = $3 + 1
     }
     $1 ~ /ATOMIC_POSITIONS/ {
       if(tolower($0) ~ /angstrom/) { a = 1; b = 1; c = 1 }
       else if(tolower($0) ~ /bohr/) { a = 0.529177249; b = 0.529177249; c = 0.529177249 }

       for(i = 1;i < j;i++){
         getline
         printf "ATOM   %4d %-2s   LIG  %4d    %8.3f%8.3f%8.3f  1.00  0.00          %2s\n", i, $1, i, $2 * a, $3 * b, $4 * c, $1
       }
       print "END"
     }' ${1:-input.txt}
