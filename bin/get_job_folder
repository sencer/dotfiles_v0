#!/usr/bin/env bash
jobId=( $( qstat -u $USER | awk -vjob="$1" '
  NR>5 && job".job" ~ gensub(/[][^$.*?+{}\\()|]/,"\\\\&", "g", $4) {
    print gensub("\\..*","","",$1)
  }'
))
if [[ $jobId != "" ]]; then
  jobFolder=$(qstat -f $jobId | \
    sed -rn '/Output_Path/,+1H;g;${s/\n\s*|(.*:|'$USER'|home|scratch)\/|[^/]*$//g;p}')
  if [[ jobFolder == "" ]]; then
    exit 1
  else
    folder=`grep "^$PBS_SERVER" $PBS_SERVER_FILE|cut -d' ' -f4`
    [ $folder == "." ] && folder=""
    echo $HOME/$PBS_SERVER/${jobFolder}
  fi
else
  exit 1
fi
