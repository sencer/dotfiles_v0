#!/usr/bin/env bash
jobId=($(qstat -u $USER|awk -vjob="$1" 'NR>5 && job".job" ~ $4 {print gensub("\\..*","","",$1)}'))
if [[ $jobId != "" ]]; then
  jobFolder=$(qstat -f $jobId | \
    sed -rn '/Output_Path/,+1H;g;${s/\n\s*|(.*:|'$USER'|home|scratch)\/|[^/]*$//g;p}')
  if [[ jobFolder == "" ]]; then
    exit 1
  else
    folder=`grep "^$PBSSERVER" $PBSSERVERFILE|cut -d' ' -f4`
    [ $folder == "." ] && folder=""
    echo $HOME/$PBSSERVER/${jobFolder}
  fi
else
  exit 1
fi
