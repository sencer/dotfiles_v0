#!/usr/bin/awk -f
BEGIN {
  a2b = 1.889716
}
/PRIMCOORD/{
  getline
  nat = $1
  for(i=0;i<nat;i++){
    getline tmp
    atom[i][0] = "1"
    split(tmp, atom[i])
  }
  getline
  getline
  getline
  getline
  nx = $1; ny = $2; nz = $3
  getline
  print "generated from xsf file"
  print ""
  printf "%-4d %12.6f %12.6f %12.6f\n", nat, 0.0, 0.0, 0.0
  getline
  printf "%-4d %12.6f %12.6f %12.6f\n", nx, $1/nx*a2b, 0.0, 0.0
  getline
  printf "%-4d %12.6f %12.6f %12.6f\n", ny, 0.0, $2/ny*a2b, 0.0
  getline
  printf "%-4d %12.6f %12.6f %12.6f\n", nz, 0.0, 0.0, $3/nz*a2b
  for(i in atom)
    printf "%-3d %8.4f %14.10f %14.10f %14.10f\n", atom[i][1], atom[i][1], atom[i][2]*a2b, atom[i][3]*a2b, atom[i][4]*a2b
  arrlen = 0
  while( (getline) > 0 ) {
    for(i = 1; i < NF+1; i++) {
      data[arrlen] = $i
      arrlen++
    }
  }
  n = 1
  for( i = 0; i < nx; i++ ) {
    for( j = 0; j < ny; j++ ) {
      for( k = 0; k < nz; k++ ) {
        printf "%14.6E ", data[ k * nx * ny + j * nx + i ]
        if(n % 6 == 0)
          printf "\n"
        n++
      }
    }
  }
}

# vim: ft=awk
