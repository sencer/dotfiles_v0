#!/usr/bin/awk -f
BEGIN {
  a2b = 1.889716
}
/PRIMCOORD/{
  getline
  nat = $1
  for(i=0;i<nat;i++){
    getline tmp
    atom[i][0] = "1"
    split(tmp, atom[i])
  }
  getline
  getline
  getline
  getline tmp
  split(tmp, n)
  getline
  print "generated from xsf file"
  print ""
  printf "%-4d %12.6f %12.6f %12.6f\n", nat, 0.0, 0.0, 0.0
  for(i=1;i<4;i++){
    getline
    tmp = a2b / n[i]
    printf "%-4d %12.6f %12.6f %12.6f\n", n[i], $1*tmp, $2*tmp, $3*tmp
  }
  for(i in atom)
    printf "%-3d %8.4f %14.10f %14.10f %14.10f\n", atom[i][1], atom[i][1], atom[i][2]*a2b, atom[i][3]*a2b, atom[i][4]*a2b
  arrlen = 0
  while( (getline) > 0 ) {
    for(i = 1; i < NF+1; i++) {
      data[arrlen] = $i
      arrlen++
    }
  }
  num = 1
  for( i = 0; i < n[1]; i++ ) {
    for( j = 0; j < n[2]; j++ ) {
      for( k = 0; k < n[3]; k++ ) {
        printf "%14.6E ", data[ k * n[1] * n[2] + j * n[1] + i ]
        if(num % 6 == 0)
          printf "\n"
        num++
      }
    }
  }
}

# vim: ft=awk
