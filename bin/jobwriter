#!/bin/bash
k=${1:-1}
i=${2:-1}
g=${3:-300}
{
  cat $HOME/$PBS_SERVER/.jobtemplate
  cat <<-'EOF'
		
		##########   job parameters  ##########

		kpools=%kpools%
		images=%images%
		exec=%exec%
		exec_path="%path%"

		##########  changes to make  ##########

		#determine the number of cpus
		numprocs=%numprocs%

		#change in input file
		sed -i "s/\\(max_seconds\\s*=\\s*\\)[0-9]*/\\1$maxseconds/" %in%

		# run pre-job hooks if available
		[[ -f pre.sh ]] && bash pre.sh

		#now execute
		%scheduler% %prepara% $exec_path/$exec %postpara% %in% >> %out%

		# run post-job hooks if available
		[[ -f post.sh ]] && bash post.sh
	EOF
} | templr $HOME/$PBS_SERVER/.jobconfig -if -kpools $k -images $i -gap $g
# if [[ -f $HOME/.jobconfig ]]; then
# else
# 	[[ -n $PBS_SERVER ]] && ras -pbs \$HOME/bin/jobwriter "$@"
# fi
