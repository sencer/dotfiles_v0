#!/bin/sh
PDFFILE="$1"
VIMSERVER=`basename ${1%.pdf}|tr '[:lower:]' '[:upper:]'`
if vim --serverlist|grep $VIMSERVER; then
  EDITORCMD="gvim --servername '`basename "$1" .pdf`' --remote-send ':buf ${PDFFILE/.pdf/.tex}<CR>:%l<CR>'"
else
  EDITORCMD="gvim --servername '`basename "$1" .pdf`' --remote-silent '+%l<Enter>zR' %f"
fi

if [ -f "$PDFFILE" ];then
  if [ -f "${PDFFILE%%.pdf}.synctex.gz" ];then
    nohup &>/dev/null evince_backward_search "$PDFFILE" "$EDITORCMD"&
    BACKWARD_SEARCH_PID=$!
    # echo $BACKWARD_SEARCH_PID
  fi
fi

/usr/bin/evince "$@"

if [ "$BACKWARD_SEARCH_PID" ];then
  kill $BACKWARD_SEARCH_PID
fi
