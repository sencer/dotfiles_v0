#!/usr/bin/env bash
filename='projw'
outdir='../../'
time=25

while [[ $# > 0 ]]; do
  if [[ "$1" == *./* ]]; then
    outdir="$1"
    shift
  elif [[ $1 = -o ]]; then
    shift
    filename=$1
    shift 
  elif [[ $1 = -t ]]; then
    shift
    time=$1
    shift
  fi
done

mkdir -p pp/$filename && cd pp/$filename

cat > $filename.in <<-EOF
	&PROJWFC
	  outdir  = '$outdir'
	  DeltaE  = 0.01
	  filpdos = "pdos"
	  filproj = "proj"
	/
EOF

{
  cat $HOME/$PBS_SERVER/.jobtemplate | sed 's/%queue%/%short%/'
  echo "%scheduler% -n 1 %path%/projwfc.x < $filename.in > $filename.out"
} | templr $HOME/$PBS_SERVER/.jobconfig -if -nodes 1 -ppn 1 -walltime 00:10:00 > $filename.job

qsub $filename.job
