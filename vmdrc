menu main on
menu main move 450 641
menu graphics move 929 115
display resize 470 500
display reposition 450 930
display projection orthographic
display nearclip set 0
display depthcue off
axes location off

global fname

color Display Background white
# automate povray

render options POV3 {povray +W%w +H%h -I%s -O%s.png +D +X +A +UA +FN}

proc pov {fname} {
  set tmp [file rootname $fname]
  set i 0
  set tmp2 $tmp
  while { [file exists $tmp.pov] } {
    set i [expr $i+1]
    set tmp $tmp2$i
  }
  puts_red "INFO) Writing $tmp.pov"
  render POV3 $tmp.pov [render options POV3]
  file rename  $tmp.pov.png $tmp.png
  puts_red "INFO) Image file saved to $tmp.png"
}

proc puts_red {string} {
  puts stdout "\033\[31m$string\033\[0m"
}

# putting these things in a proc gets rid of unnecessary output!
proc initial_settings {home} {
  global auto_path
  global fname
  set auto_path [concat $home/.vmd $auto_path]
  if { [molinfo top] > -1 } {
    set fname [pwd]/[molinfo top get filename]
    cd [file dirname $fname]
  }
  return ""
}
user add key v { pov $fname }
user add key q { exit }
user add key Control-w { savexyz }

after idle {
  package require pbctools
  initial_settings $env(HOME)
  #load my scripts in this order!
  state
  cell
  # trace variable vmd_initialize_structure w {source view.vmd}
}
