#
# A monochrome theme that displays basic information.
#
# Authors:
#   Brian Tse <briankftse@gmail.com>
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#
# Screenshots:
#   http://i.imgur.com/zLZNK.png
#


function prompt_sencer_precmd {
  local DATAFILE=$HOME/.dotfiles/data/namaz
  export NAMAZ=$(head -1 $DATAFILE)
  if [[ $(wc -l < $DATAFILE) -lt 15 ]]; then
    prompt_namaz_guncelle
  fi
  while [[ $NAMAZ -le $[`date +%s`+daylight*60] ]]; do
    sed -i 1d $DATAFILE
    export NAMAZ=$(head -1 $DATAFILE)
  done
}

function prompt_namaz_guncelle {
  local DATAFILE=$HOME/.dotfiles/data/namaz
  local url='http://api.namazvakitleri.com.tr/getTimes/json/217'
  date -f <(curl 2>/dev/null  $url | \
            command sed -r 's/\{/\n{/g;s/(\{|")[ a-zD"},:]+/ /g' |\
            tail -n +6 |\
            awk '{for(i=3;i<9;i++)printf "%sT%s\n", $1, $i}') +%s >! \
            $DATAFILE
}

function prompt_sencer_setup {
  prompt_opts=(cr percent subst)
  # source <(vakit export)
  # if [ `date +%:::z` -eq -4 ];then
  #   daylight=1
  # else
  #   daylight=0
  # fi
  # Load required functions.
  autoload -Uz add-zsh-hook

  # Add hook for calling vcs_info before each command.
  # add-zsh-hook precmd prompt_sencer_precmd

  # Define prompts.
  export PROMPT="%F{73}%h:%F{174}%C%f " 
  # export RPROMPT="%F{73}\$(prompt_kalan_vakit)[\${PWD/\/home\/sselcuk/~}]%f" 
  export RPROMPT="%F{73}[\${PWD/${HOME//\//\\/}/~}]%f"
}

prompt_sencer_setup "$@"

# vim: ft=zsh
